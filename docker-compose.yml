
services:
  nifi:
    image: apache/nifi:2.6.0
    container_name: nifi
    ports:
      - "8443:8443"  # HTTPS UI and API
    environment:
      # Single User Authentication
      - SINGLE_USER_CREDENTIALS_USERNAME=${NIFI_USERNAME:-admin}
      - SINGLE_USER_CREDENTIALS_PASSWORD=${NIFI_PASSWORD:-adminadminadmin}

      # JVM Memory Settings
      - NIFI_JVM_HEAP_INIT=512m
      - NIFI_JVM_HEAP_MAX=2g

      # Web Properties
      - NIFI_WEB_HTTPS_PORT=8443
      - NIFI_WEB_HTTPS_HOST=0.0.0.0
    volumes:
      # Persist NiFi data
      - nifi_database_repository:/opt/nifi/nifi-current/database_repository
      - nifi_flowfile_repository:/opt/nifi/nifi-current/flowfile_repository
      - nifi_content_repository:/opt/nifi/nifi-current/content_repository
      - nifi_provenance_repository:/opt/nifi/nifi-current/provenance_repository
      - nifi_state:/opt/nifi/nifi-current/state
      - nifi_conf:/opt/nifi/nifi-current/conf
      - nifi_logs:/opt/nifi/nifi-current/logs
    networks:
      - nifi-network
    healthcheck:
      test: ["CMD", "curl", "-k", "-f", "https://localhost:8443/nifi/"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    restart: unless-stopped

volumes:
  nifi_database_repository:
  nifi_flowfile_repository:
  nifi_content_repository:
  nifi_provenance_repository:
  nifi_state:
  nifi_conf:
  nifi_logs:

networks:
  nifi-network:
    driver: bridge
